<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>toc</title>
    <script src="./../plugins/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="./../plugins/popper/1.15.0/umd/popper.min.js"></script>
    <script src="./../plugins/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="./../plugins/bootstrap/bootstrap-switch.js"></script>
    <link href="./../plugins/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="./../plugins/fontAwesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="./../plugins/bootstrap/bootstrap-switch.min.css" rel="stylesheet">
    <script src="./../js/law-main.js"></script>

    <!--    ueditor-->
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <script type="text/javascript" charset="utf-8" src="../ueditor/ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="../ueditor/ueditor.all.min.js"></script>
    <!--建议手动加在语言，避免在ie下有时因为加载语言失败导致编辑器加载失败-->
    <!--这里加载的语言文件会覆盖你在配置项目里添加的语言类型，比如你在配置项目里配置的是英文，这里加载的中文，那最后就是中文-->
    <script type="text/javascript" charset="utf-8" src="../ueditor/lang/zh-cn/zh-cn.js"></script>
    <script src="./../js/my-treec.js"></script>
    <script>
        let lawId = GetQueryString("lawId");

        /**
         * @return {string}
         */
        function GetQueryString(name) {
            var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
            var r = window.location.search.substr(1).match(reg);
            if (r != null) return unescape(r[2]);
            return null;
        }

        let rVue;
        let defaultNode = {
            id:-1,
            content:"无",
            title:"",
            style:"",
            extra:"",
            children:[],
        }
        $(function () {
            rVue = new Vue({
                el: "#content",
                data: {
                    remarkType: "REMARK",
                    content: "",
                    isAppendTo: false,
                    treeData: {},
                    selectLaw:{
                        id:-1,
                        content:"",
                        title:"",
                        style:"",
                        extra:"",
                        children:[],
                    }
                },
                filters: {
                    countFilter: function (count) {
                        if (count > 0) {
                            return count + "条";
                        } else {
                            return "暂无数据"
                        }
                    },
                    nameFilter: function (name, maxSize) {
                        if (name.length > maxSize) {
                            name = name.substring(0, maxSize - 1) + "...";
                        }
                        return name;
                    },
                    getfullName: function (lawList) {
                        if (lawList.length > 0) {
                            return lawList[0]["fullName"];
                        }
                    },
                    subContent: function (content, maxSize) {
                        maxSize = !! maxSize ? 10 : maxSize;
                        if (!!content) {
                            return "错误数据";
                        }
                        if (content.length > maxSize) {
                            content = content.substring(0, maxSize) + "...";
                        }
                        return content;
                    },
                    titleFilter(tag){
                        if(tag)
                            return `${tag.name} (${tag.count}) 法条`
                    }
                },
                methods: {
                    del(){
                        if(this.selectLaw.style!=="catalog"){
                            alert("只能给目录添加子节点")
                            return;
                        }
                        if(this.selectLaw.id===-1){
                            alert("要先选择节点")
                            return;
                        }
                        $.get("/web/v1/law/delLawTree", {"id": this.selectLaw.id}, function (data) {
                            console.log("law",data);
                        }, "json");
                    },
                    sub(){
                        console.log(this.selectLaw);
                        if(this.selectLaw.style!=="catalog"){
                            alert("只能给目录添加子节点")
                          return;
                        }
                        if(this.selectLaw.id===-1){
                            alert("要先选择节点")
                          return;
                        }
                        let data = {
                            content:$("#c-content").val().trim(),
                            title:$("#title").val().trim(),
                            style:"catalog",
                            extra:$("#style").val().trim(),
                            parent:this.selectLaw.id,
                        }
                        $.post("/web/v1/law/addLawTree", data, function (data) {
                            console.log("law",data);
                        }, "json");
                        this.selectLaw = defaultNode;
                    },
                    selectData(data){
                        this.selectLaw=data;
                    }
                },
                components: {
                    'my-treec': myTreec,
                },
                computed:{
                }
            });
            $.get("/web/v1/law/getLawTree", {"lawId": lawId}, function (data) {
                rVue.treeData = data.content;
                console.log("catalogL: ", rVue.treeData);
            }, "json");
        });
    </script>
</head>
<body>
<div  id="content" class="container">
    <div>
        <h3>说明:</h3>
        <pre>
            请按照指示填写.
            内容 - 是目录展示的数据,
            提示 - 鼠标悬停后的提示,
            类型 - 填写的项在目中中的类型,
                有:{"catalog":目录树上的目录节点, 可以添加子节点
                    "law":法条节点, 目前没添加先关功能, 先添加目录树的非法条节点
                }
            拓展 - 拓展字段, 预计在 类型为catalog时存放id数组,在law时存放有亲缘关系的节点

        </pre>
        <div>
            被选中的节点: {{selectLaw.content}}
        </div>
    </div>
    <div class="row">
        <my-treec :item="treeData" @select-data="selectData" class="col-5"></my-treec>
        <div class="col-7">
            <button @click="del()" title="删除选中" type="submit" class="submitBtn btn btn-primary btn-block">
                删除
            </button>
            <form>
                <div class="form-group">
                    <label for="c-content">内容</label>
                    <input id="c-content" type="text" class="form-control" name="password" placeholder="请输入内容" required data-eye>
                </div>
                 <div class="form-group">
                    <label for="title">提示</label>
                    <input id="title" type="text" class="form-control" name="password" placeholder="请输入内容" required data-eye>
                </div>
                 <div class="form-group">
                    <label for="style">类型</label>
                    <input id="style" type="text" class="form-control" name="password" placeholder="请输入内容" value="catalog" disabled required data-eye>
                </div>
                 <div class="form-group">
                    <label for="extra">拓展</label>
                    <input id="extra" type="text" class="form-control" name="password" placeholder="请输入内容" value="暂不开放" disabled  required data-eye>
                </div>
                <div class="form-group no-margin">
                    <button @click="sub()" title="提交内容" type="submit" class="submitBtn btn btn-primary btn-block">
                        提交
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
</body>
</html>