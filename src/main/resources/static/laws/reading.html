<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <title>法条解读</title>
    <link href="../css/popup.css" rel="stylesheet">
    <link href="./../plugins/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="./../plugins/fontAwesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script src="./../plugins/jquery/3.3.1/jquery.min.js"></script>
    <!--    <script src="./../plugins/vue/2.2.2/vue.min.js"></script>-->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="./../plugins/popper/1.15.0/umd/popper.min.js"></script>
    <script src="./../plugins/bootstrap/4.3.1/js/bootstrap.min.js"></script>
    <script src="../js/popup.js" type="text/javascript"></script>
    <script src="../js/uEdit.js" type="text/javascript"></script>


    <script type="text/javascript" charset="utf-8" src="../ueditor/ueditor.config.js"></script>
    <script type="text/javascript" charset="utf-8" src="../ueditor/ueditor.all.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="../ueditor/lang/zh-cn/zh-cn.js"></script>
</head>
<body>
<nav class="navbar navbar-expand-sm bg-light">
    <ul class="navbar-nav container">
        <li class="nav-item">
            <a href="javascript:;" onclick="javascript:history.go(-1);" title="点击返回上一页" class="nav-link">返回上一页</a>
        </li>
    </ul>
</nav>
<div id="content" class="container">
    <div class="card">
        <div id="law-content" class="card-body">
            <input type="hidden" name="id" :value="law.id">
            <h5 class="text-center">{{law.fullName}}</h5>
            <p style="text-indent: 2em;">{{law.content}}</p>
        </div>
        <div class="card-body">
            <div class="card-header">
                解读
                <button v-if="isAdmin && hasReading" class="float-right btn btn-sm btn-outline-secondary"
                        @click="showToggle">修改
                </button>
            </div>
            <div class="card">
                <div v-if="hasReading" v-html="reading">
                </div>
                <div v-else>
                    <div v-if="isAdmin" class="card-body">
                        <p class="card-text text-center text-secondary">本法条还未有解读, 请添加!</p>
                    </div>
                    <div v-else class="card-body">
                        <p class="card-text text-center text-secondary">本法条还未有解读, 等待管理员添加!</p>
                    </div>
                </div>
            </div>
        </div>
        <div v-show="isShow" class="card-body">
            <hr>
            <script id="editor" type="text/plain" style="width:100%;height:500px;"></script>
            <div class="btn btn-primary submit-remark float-right" @click="sureSubmit()">提交
            </div>
        </div>
    </div>
</div>

</body>
</html>
<script>

    let rVue;
    let lawId = GetQueryString("lawId");
    $(function () {
        let user = JSON.parse(localStorage.getItem("user"));
        rVue = new Vue({
            el: "#content",
            data: {
                law: "",
                user: user,
                remarkType: "REMARK",
                content: "",
                isAppendTo: false,
                reading: null,
                isShow: true
            },
            filters: {
                countFilter: function (count) {
                    if (count > 0) {
                        return count + "条";
                    } else {
                        return "暂无数据"
                    }
                },
                nameFilter: function (name, maxSize) {
                    if (name.length > maxSize) {
                        name = name.substring(0, maxSize - 1) + "...";
                    }
                    return name;
                },
                getfullName: function (lawList) {
                    if (lawList.length > 0) {
                        return lawList[0]["fullName"];
                    }
                },
                subContent: function (content, maxSize) {
                    maxSize = maxSize ? 10 : maxSize;
                    if (content) {
                        return "错误数据";
                    }
                    if (content.length > maxSize) {
                        content = content.substring(0, maxSize) + "...";
                    }
                    return content;
                },
            },
            methods: {
                showToggle() {
                    this.isShow = !this.isShow;
                },
                sureSubmit() {
                    if (this.isAdmin && this.hasReading) {
                        sureSubmit('/web/v1/law/updReading', refresh);
                    } else {
                        sureSubmit('/web/v1/law/addReading', refresh);
                    }
                }

            },
            computed: {
                isAdmin() {
                    return this.user.roles.includes("ROLE_ADMIN")
                },
                hasReading() {
                    return this.reading ? true : false;
                }
            }
        });
        $.get("/web/v1/law/getLawById", {"lawId": lawId}, function (data) {
            rVue.law = data.content;
        }, "json");
        $.get("/web/v1/law/getReading", {"lawId": lawId}, function (data) {
            console.log("dsada: ", data.content);
            if (data.content && data.content.content) {

                if (data.content === "未获取到解读") {
                    rVue.reading = null;
                    rVue.isShow = true;
                } else {
                    rVue.reading = data.content.content;
                    rVue.isShow = false;
                }
            }
        }, "json");
        localStorage.removeItem("lawId");
    });
    let refresh = function () {
        location.reload()
    }
</script>